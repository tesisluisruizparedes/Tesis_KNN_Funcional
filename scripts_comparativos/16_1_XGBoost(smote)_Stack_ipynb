{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[],"authorship_tag":"ABX9TyOV5bc4sa42/oDvHvsv2Z2W"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"widgets":{"application/vnd.jupyter.widget-state+json":{"ced84fcacf624658a32f9087b8ffb04c":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_2614d11db682415799a7f8da2a3b4725","IPY_MODEL_6d2355d2ee55424ab0f6de967770decf","IPY_MODEL_31b5a94ee88344748e6e22a5602d8f60"],"layout":"IPY_MODEL_c3cad1f1e5ed49369ec21019c154d772"}},"2614d11db682415799a7f8da2a3b4725":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_d3b55df01e1d4485a13b32465227a67a","placeholder":"​","style":"IPY_MODEL_d5f97f4dc1564b08a9d179dbbd628c9a","value":"⏳ Construyendo stacks: 100%"}},"6d2355d2ee55424ab0f6de967770decf":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_94c5b564a6b74ea7913f825629be19a7","max":5770,"min":0,"orientation":"horizontal","style":"IPY_MODEL_64efc26fa58241a9b40e8799be3c5cba","value":5770}},"31b5a94ee88344748e6e22a5602d8f60":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_b25fca71f11e4a42b732eef0eb4b2e10","placeholder":"​","style":"IPY_MODEL_b78e6cfd36ad4b7e859ff9feabaa0a18","value":" 5770/5770 [00:24&lt;00:00, 756.23it/s]"}},"c3cad1f1e5ed49369ec21019c154d772":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d3b55df01e1d4485a13b32465227a67a":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d5f97f4dc1564b08a9d179dbbd628c9a":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"94c5b564a6b74ea7913f825629be19a7":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"64efc26fa58241a9b40e8799be3c5cba":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"b25fca71f11e4a42b732eef0eb4b2e10":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b78e6cfd36ad4b7e859ff9feabaa0a18":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"5b54f53634a54be28fc3e9e1ad18eed3":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_e1f6b03c95434ef0911538b67a3da828","IPY_MODEL_4fd960f6a3e94bd097a37f712bb3cadc","IPY_MODEL_65ca824b45824207bdc478e31d8a7057"],"layout":"IPY_MODEL_a64e5e3778ae4989a1898a7a609d3e8e"}},"e1f6b03c95434ef0911538b67a3da828":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_777524e758e54b86a2809a895d6304a6","placeholder":"​","style":"IPY_MODEL_d2db1ea58eee469da68d2394e02a3555","value":"100%"}},"4fd960f6a3e94bd097a37f712bb3cadc":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_3160037b3e4a4891b203ff88052e9a19","max":10,"min":0,"orientation":"horizontal","style":"IPY_MODEL_43e303c1340746a1a56bfb0d8512a6fd","value":10}},"65ca824b45824207bdc478e31d8a7057":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e37abba46940466c9408dcdb05929466","placeholder":"​","style":"IPY_MODEL_0135e2e3e6d64353aa6ca1eb47a5912e","value":" 10/10 [00:26&lt;00:00,  2.60s/it]"}},"a64e5e3778ae4989a1898a7a609d3e8e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"777524e758e54b86a2809a895d6304a6":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d2db1ea58eee469da68d2394e02a3555":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"3160037b3e4a4891b203ff88052e9a19":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"43e303c1340746a1a56bfb0d8512a6fd":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"e37abba46940466c9408dcdb05929466":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0135e2e3e6d64353aa6ca1eb47a5912e":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"code","source":["# 🚗 Montar Drive\n","from google.colab import drive\n","drive.mount('/content/drive')\n","\n","# 📚 Librerías necesarias\n","import os\n","import pandas as pd\n","import numpy as np\n","from tqdm.notebook import tqdm\n","from sklearn.model_selection import StratifiedKFold\n","from sklearn.preprocessing import StandardScaler\n","from sklearn.metrics import (\n","    accuracy_score, precision_score, recall_score,\n","    f1_score, roc_auc_score, log_loss\n",")\n","from imblearn.over_sampling import SMOTE\n","from xgboost import XGBClassifier\n","\n","# 📍 Ruta de entrada\n","ruta_base = \"/content/drive/MyDrive/Datos/7_Base_Modelos_Predictivos_Reducida.parquet\"\n","df = pd.read_parquet(ruta_base)\n","\n","# 🧼 Ordenar y preparar\n","df = df.sort_values(by=[\"NIT\", \"Año\"]).copy()\n","\n","# 🎯 Construir RQ_final por empresa\n","df_rq_final = df.groupby(\"NIT\")[\"RQ\"].max().reset_index().rename(columns={\"RQ\": \"RQ_final\"})\n","df_last_year = df.groupby(\"NIT\")[\"Año\"].max().reset_index().rename(columns={\"Año\": \"Año_final\"})\n","df = df.merge(df_rq_final, on=\"NIT\").merge(df_last_year, on=\"NIT\")\n","\n","# 📦 Lista de variables financieras (excepto metadata)\n","col_excluir = ['NIT', 'Año', 'DEP', 'CIIU_Letra', 'RQ', 'RQ_final', 'Año_final']\n","variables_financieras = [col for col in df.columns if col not in col_excluir]\n","\n","# 🧱 Construcción de ventana móvil (stack de 5 años hacia atrás)\n","ventana = 5\n","df_ventanas = []\n","\n","for nit, grupo in tqdm(df.groupby(\"NIT\"), desc=\"⏳ Construyendo stacks\"):\n","    grupo = grupo.sort_values(\"Año\", ascending=False)\n","    if grupo.shape[0] < 4:\n","        continue\n","    año_final = grupo[\"Año\"].max()\n","    grupo = grupo[grupo[\"Año\"].between(año_final - ventana + 1, año_final)]\n","    if grupo.shape[0] < 4:\n","        continue\n","    fila = {}\n","    for i, (_, fila_anio) in enumerate(grupo.sort_values(\"Año\", ascending=False).iterrows()):\n","        for var in variables_financieras:\n","            fila[f\"{var}_-{i}\"] = fila_anio[var]\n","    fila[\"RQ_final\"] = grupo[\"RQ_final\"].iloc[0]\n","    fila[\"DEP\"] = grupo[\"DEP\"].iloc[0]\n","    fila[\"CIIU_Letra\"] = grupo[\"CIIU_Letra\"].iloc[0]\n","    fila[\"Año_final\"] = año_final\n","    df_ventanas.append(fila)\n","\n","df_stack = pd.DataFrame(df_ventanas)\n","print(f\"✅ Base construida: {df_stack.shape}\")\n","\n","# 🧹 Limpieza de inf y NaN\n","df_stack.replace([np.inf, -np.inf], np.nan, inplace=True)\n","limite_nan = df_stack.shape[0] * 0.5\n","df_stack.dropna(thresh=limite_nan, axis=1, inplace=True)\n","df_stack.fillna(df_stack.median(numeric_only=True), inplace=True)\n","print(f\"✅ Base limpia: {df_stack.shape}\")\n","\n","# 🎯 Variables predictoras y objetivo\n","X = df_stack.drop(columns=[\"RQ_final\", \"DEP\", \"CIIU_Letra\", \"Año_final\"])\n","y = df_stack[\"RQ_final\"]\n","\n","# 🔢 Escalado\n","scaler = StandardScaler()\n","X_scaled = scaler.fit_transform(X)\n","\n","# 🧪 Validación cruzada con SMOTE y XGBoost\n","kf = StratifiedKFold(n_splits=10, shuffle=True, random_state=42)\n","\n","accuracy_list, precision_list, recall_list = [], [], []\n","f1_list, auc_list, logloss_list = [], [], []\n","\n","print(\"🚀 Ejecutando validación cruzada...\")\n","\n","for train_idx, test_idx in tqdm(kf.split(X_scaled, y), total=10):\n","    X_train, X_test = X_scaled[train_idx], X_scaled[test_idx]\n","    y_train, y_test = y.iloc[train_idx], y.iloc[test_idx]\n","\n","    smote = SMOTE(random_state=42)\n","    X_train_sm, y_train_sm = smote.fit_resample(X_train, y_train)\n","\n","    model = XGBClassifier(\n","        n_estimators=100, max_depth=6, learning_rate=0.1,\n","        subsample=0.8, colsample_bytree=0.8,\n","        use_label_encoder=False, eval_metric=\"logloss\",\n","        random_state=42\n","    )\n","\n","    model.fit(X_train_sm, y_train_sm)\n","    y_pred = model.predict(X_test)\n","    y_prob = model.predict_proba(X_test)[:, 1]\n","\n","    accuracy_list.append(accuracy_score(y_test, y_pred))\n","    precision_list.append(precision_score(y_test, y_pred, zero_division=0))\n","    recall_list.append(recall_score(y_test, y_pred, zero_division=0))\n","    f1_list.append(f1_score(y_test, y_pred, zero_division=0))\n","    auc_list.append(roc_auc_score(y_test, y_prob))\n","    logloss_list.append(log_loss(y_test, y_prob))\n","\n","# 📊 Resultados finales\n","print(\"\\n📋 Resultados promedio (10 folds):\")\n","print(f\"Accuracy:   {np.mean(accuracy_list):.4f} ± {np.std(accuracy_list):.4f}\")\n","print(f\"Precision:  {np.mean(precision_list):.4f} ± {np.std(precision_list):.4f}\")\n","print(f\"Recall:     {np.mean(recall_list):.4f} ± {np.std(recall_list):.4f}\")\n","print(f\"F1-score:   {np.mean(f1_list):.4f} ± {np.std(f1_list):.4f}\")\n","print(f\"AUC:        {np.mean(auc_list):.4f} ± {np.std(auc_list):.4f}\")\n","print(f\"LogLoss:    {np.mean(logloss_list):.4f} ± {np.std(logloss_list):.4f}\")\n","\n","# 🧠 Top 3 variables más importantes\n","importances = model.feature_importances_\n","feature_names = X.columns\n","top_idx = np.argsort(importances)[::-1][:3]\n","top_vars = [feature_names[i] for i in top_idx]\n","\n","# 🧾 Guardar resultados en CSV separado para modelos con stack\n","ruta_csv_stack = \"/content/drive/MyDrive/Resultados/resultados_modelos_stack5_RQfinal.csv\"\n","\n","if os.path.exists(ruta_csv_stack):\n","    resumen_stack = pd.read_csv(ruta_csv_stack)\n","else:\n","    resumen_stack = pd.DataFrame(columns=[\n","        'Base', 'Modelo', 'Naturaleza', 'Temporalidad', 'Tipo de aprendizaje',\n","        'Accuracy', 'Desv. Accuracy', 'Precision', 'Desv. Precision',\n","        'Recall', 'Desv. Recall', 'F1-score promedio', 'Desviación F1',\n","        'AUC', 'Desv. AUC', 'LogLoss', 'Desv. LogLoss',\n","        'Top 1 variable', 'Top 2 variable', 'Top 3 variable'\n","    ])\n","\n","nueva_fila = {\n","    'Base': 'Turismo',\n","    'Modelo': 'XGBoost (Stack 5 años)',\n","    'Naturaleza': 'Avanzado',\n","    'Temporalidad': 'Estática con stack',\n","    'Tipo de aprendizaje': 'Supervisado',\n","    'Accuracy': round(np.mean(accuracy_list), 4),\n","    'Desv. Accuracy': round(np.std(accuracy_list), 4),\n","    'Precision': round(np.mean(precision_list), 4),\n","    'Desv. Precision': round(np.std(precision_list), 4),\n","    'Recall': round(np.mean(recall_list), 4),\n","    'Desv. Recall': round(np.std(recall_list), 4),\n","    'F1-score promedio': round(np.mean(f1_list), 4),\n","    'Desviación F1': f\"±{round(np.std(f1_list), 4)}\",\n","    'AUC': round(np.mean(auc_list), 4),\n","    'Desv. AUC': round(np.std(auc_list), 4),\n","    'LogLoss': round(np.mean(logloss_list), 4),\n","    'Desv. LogLoss': round(np.std(logloss_list), 4),\n","    'Top 1 variable': top_vars[0] if len(top_vars) > 0 else None,\n","    'Top 2 variable': top_vars[1] if len(top_vars) > 1 else None,\n","    'Top 3 variable': top_vars[2] if len(top_vars) > 2 else None,\n","}\n","\n","resumen_stack = pd.concat([resumen_stack, pd.DataFrame([nueva_fila])], ignore_index=True)\n","resumen_stack.to_csv(ruta_csv_stack, index=False)\n","print(f\"\\n✅ Resultados guardados en: {ruta_csv_stack}\")\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000,"referenced_widgets":["ced84fcacf624658a32f9087b8ffb04c","2614d11db682415799a7f8da2a3b4725","6d2355d2ee55424ab0f6de967770decf","31b5a94ee88344748e6e22a5602d8f60","c3cad1f1e5ed49369ec21019c154d772","d3b55df01e1d4485a13b32465227a67a","d5f97f4dc1564b08a9d179dbbd628c9a","94c5b564a6b74ea7913f825629be19a7","64efc26fa58241a9b40e8799be3c5cba","b25fca71f11e4a42b732eef0eb4b2e10","b78e6cfd36ad4b7e859ff9feabaa0a18","5b54f53634a54be28fc3e9e1ad18eed3","e1f6b03c95434ef0911538b67a3da828","4fd960f6a3e94bd097a37f712bb3cadc","65ca824b45824207bdc478e31d8a7057","a64e5e3778ae4989a1898a7a609d3e8e","777524e758e54b86a2809a895d6304a6","d2db1ea58eee469da68d2394e02a3555","3160037b3e4a4891b203ff88052e9a19","43e303c1340746a1a56bfb0d8512a6fd","e37abba46940466c9408dcdb05929466","0135e2e3e6d64353aa6ca1eb47a5912e"]},"id":"s_ESZjafC2i_","executionInfo":{"status":"ok","timestamp":1747666621429,"user_tz":300,"elapsed":54517,"user":{"displayName":"TesisLuis Ruiz Paredes","userId":"09818400265379829088"}},"outputId":"0abd9927-96a9-46ab-d292-63a921925bff"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\"/content/drive\", force_remount=True).\n"]},{"output_type":"display_data","data":{"text/plain":["⏳ Construyendo stacks:   0%|          | 0/5770 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"ced84fcacf624658a32f9087b8ffb04c"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["✅ Base construida: (4067, 310)\n","✅ Base limpia: (4067, 87)\n","🚀 Ejecutando validación cruzada...\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/10 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"5b54f53634a54be28fc3e9e1ad18eed3"}},"metadata":{}},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [14:56:33] WARNING: /workspace/src/learner.cc:740: \n","Parameters: { \"use_label_encoder\" } are not used.\n","\n","  warnings.warn(smsg, UserWarning)\n","/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [14:56:35] WARNING: /workspace/src/learner.cc:740: \n","Parameters: { \"use_label_encoder\" } are not used.\n","\n","  warnings.warn(smsg, UserWarning)\n","/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [14:56:39] WARNING: /workspace/src/learner.cc:740: \n","Parameters: { \"use_label_encoder\" } are not used.\n","\n","  warnings.warn(smsg, UserWarning)\n","/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [14:56:43] WARNING: /workspace/src/learner.cc:740: \n","Parameters: { \"use_label_encoder\" } are not used.\n","\n","  warnings.warn(smsg, UserWarning)\n","/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [14:56:45] WARNING: /workspace/src/learner.cc:740: \n","Parameters: { \"use_label_encoder\" } are not used.\n","\n","  warnings.warn(smsg, UserWarning)\n","/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [14:56:47] WARNING: /workspace/src/learner.cc:740: \n","Parameters: { \"use_label_encoder\" } are not used.\n","\n","  warnings.warn(smsg, UserWarning)\n","/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [14:56:49] WARNING: /workspace/src/learner.cc:740: \n","Parameters: { \"use_label_encoder\" } are not used.\n","\n","  warnings.warn(smsg, UserWarning)\n","/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [14:56:51] WARNING: /workspace/src/learner.cc:740: \n","Parameters: { \"use_label_encoder\" } are not used.\n","\n","  warnings.warn(smsg, UserWarning)\n","/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [14:56:56] WARNING: /workspace/src/learner.cc:740: \n","Parameters: { \"use_label_encoder\" } are not used.\n","\n","  warnings.warn(smsg, UserWarning)\n","/usr/local/lib/python3.11/dist-packages/xgboost/core.py:158: UserWarning: [14:56:58] WARNING: /workspace/src/learner.cc:740: \n","Parameters: { \"use_label_encoder\" } are not used.\n","\n","  warnings.warn(smsg, UserWarning)\n"]},{"output_type":"stream","name":"stdout","text":["\n","📋 Resultados promedio (10 folds):\n","Accuracy:   0.8397 ± 0.0179\n","Precision:  0.9091 ± 0.0147\n","Recall:     0.8824 ± 0.0186\n","F1-score:   0.8954 ± 0.0120\n","AUC:        0.8996 ± 0.0109\n","LogLoss:    0.3519 ± 0.0244\n","\n","✅ Resultados guardados en: /content/drive/MyDrive/Resultados/resultados_modelos_stack5_RQfinal.csv\n"]},{"output_type":"stream","name":"stderr","text":["<ipython-input-4-a63bd1423478>:160: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.\n","  resumen_stack = pd.concat([resumen_stack, pd.DataFrame([nueva_fila])], ignore_index=True)\n"]}]}]}